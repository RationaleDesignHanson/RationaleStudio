'use client';

import { useState } from 'react';
import { Smartphone, Cloud, Database, ArrowDown, ArrowUp, Lock } from 'lucide-react';

/**
 * TechnicalArchitectureDiagram: Layered System Architecture
 *
 * Shows three layers:
 * 1. Client Layer (iOS 17+) - SwiftUI, SwiftData, CloudKit, VisionKit, EventKit
 * 2. Backend Services - Supabase, OpenAI, Vercel, Cloudflare
 * 3. Data Flow - Recipe import ‚Üí processing ‚Üí storage ‚Üí sync ‚Üí share
 */

interface TechBlock {
  id: string;
  name: string;
  fullName: string;
  purpose: string;
  colorAccent: string;
}

const clientTech: TechBlock[] = [
  {
    id: 'swiftui',
    name: 'SwiftUI',
    fullName: 'SwiftUI 5.0',
    purpose: 'Native UI',
    colorAccent: '#4299E1' // Blue
  },
  {
    id: 'swiftdata',
    name: 'SwiftData',
    fullName: 'SwiftData',
    purpose: 'Local + iCloud',
    colorAccent: '#48BB78' // Green
  },
  {
    id: 'cloudkit',
    name: 'CloudKit',
    fullName: 'CloudKit',
    purpose: 'Sync & Backup',
    colorAccent: '#9F7AEA' // Purple
  },
  {
    id: 'visionkit',
    name: 'VisionKit',
    fullName: 'VisionKit',
    purpose: 'OCR Capture',
    colorAccent: '#F6AD55' // Orange
  },
  {
    id: 'eventkit',
    name: 'EventKit',
    fullName: 'EventKit',
    purpose: 'Reminders',
    colorAccent: '#D4AF37' // Gold
  }
];

const backendTech: TechBlock[] = [
  {
    id: 'supabase',
    name: 'Supabase',
    fullName: 'Supabase',
    purpose: 'Auth + DB + Storage',
    colorAccent: '#48BB78' // Green
  },
  {
    id: 'openai',
    name: 'OpenAI',
    fullName: 'OpenAI API',
    purpose: 'LLM Parsing (5-10%)',
    colorAccent: '#4299E1' // Blue
  },
  {
    id: 'vercel',
    name: 'Vercel',
    fullName: 'Vercel Edge',
    purpose: 'Scraping + JSON-LD',
    colorAccent: '#FFFFFF' // White
  },
  {
    id: 'cloudflare',
    name: 'Cloudflare',
    fullName: 'Cloudflare R2',
    purpose: 'CDN + Images',
    colorAccent: '#F6AD55' // Orange
  }
];

const dataFlowSteps = [
  { id: 1, label: 'URL Paste', icon: 'üìé' },
  { id: 2, label: 'Fetch & Extract', icon: 'üîç' },
  { id: 3, label: 'LLM Fallback', icon: 'ü§ñ' },
  { id: 4, label: 'SwiftData Store', icon: 'üíæ' },
  { id: 5, label: 'iCloud Sync', icon: '‚òÅÔ∏è' },
  { id: 6, label: 'Share Export', icon: 'üì§' }
];

export default function TechnicalArchitectureDiagram() {
  const [hoveredTech, setHoveredTech] = useState<string | null>(null);
  const [hoveredLayer, setHoveredLayer] = useState<string | null>(null);

  return (
    <div className="relative w-full bg-gradient-to-br from-[#FBF8F3] to-white rounded-2xl p-8 border-2 border-[#F4A460]/30 shadow-lg">
      {/* Header */}
      <div className="text-center mb-8">
        <h3 className="text-2xl font-bold text-[#2D2D2D] mb-2" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
          Technical Architecture: Modern, Scalable, Private
        </h3>
        <p className="text-sm text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
          Three-layer system with local-first data strategy
        </p>
      </div>

      {/* Technical Badges (Top Right) */}
      <div className="absolute top-8 right-8 space-y-1">
        <div className="px-3 py-1 bg-white border-2 border-[#E85D4D]/30 rounded-lg text-xs text-[#2D2D2D] shadow-sm" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
          iOS 17+
        </div>
        <div className="px-3 py-1 bg-white border-2 border-[#E85D4D]/30 rounded-lg text-xs text-[#2D2D2D] shadow-sm" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
          Swift 5.9
        </div>
        <div className="px-3 py-1 bg-white border-2 border-[#E85D4D]/30 rounded-lg text-xs text-[#2D2D2D] shadow-sm" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
          SwiftUI 5.0
        </div>
      </div>

      {/* Layer 1: Client Layer */}
      <div
        className="mb-6 p-6 rounded-2xl border-2 transition-all duration-300"
        style={{
          backgroundColor: 'white',
          borderColor: hoveredLayer === 'client' ? 'var(--color-heirloom-coral)' : 'var(--color-heirloom-orange)'
        }}
        onMouseEnter={() => setHoveredLayer('client')}
        onMouseLeave={() => setHoveredLayer(null)}
      >
        {/* Layer Header */}
        <div className="flex items-center gap-3 mb-4">
          <Smartphone className="w-6 h-6 text-[#E85D4D]" />
          <div>
            <h4 className="text-base font-bold text-[#2D2D2D]" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              CLIENT LAYER (iOS 17+)
            </h4>
            <p className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              User Device ‚Ä¢ Native iOS Frameworks
            </p>
          </div>
        </div>

        {/* Tech Blocks */}
        <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
          {clientTech.map((tech) => (
            <div
              key={tech.id}
              className={`
                p-3 rounded-xl border-2 transition-all duration-300 cursor-pointer
                ${hoveredTech === tech.id ? 'scale-105 shadow-md' : 'scale-100'}
              `}
              style={{
                backgroundColor: 'var(--color-heirloom-light-cream)',
                borderColor: hoveredTech === tech.id ? tech.colorAccent : 'var(--color-heirloom-orange)'
              }}
              onMouseEnter={() => setHoveredTech(tech.id)}
              onMouseLeave={() => setHoveredTech(null)}
            >
              {/* Logo Placeholder */}
              <div
                className="w-10 h-10 rounded-lg mb-2 flex items-center justify-center text-xs font-bold"
                style={{
                  backgroundColor: `${tech.colorAccent}20`,
                  color: tech.colorAccent
                }}
              >
                {tech.name.substring(0, 2).toUpperCase()}
              </div>

              {/* Tech Name */}
              <h5
                className="text-xs font-bold text-[#2D2D2D] mb-1"
                style={{ fontFamily: 'JetBrains Mono, monospace' }}
              >
                {tech.name}
              </h5>

              {/* Purpose */}
              <p
                className="text-[10px] text-[#2D2D2D]/70"
                style={{ fontFamily: 'JetBrains Mono, monospace' }}
              >
                {tech.purpose}
              </p>
            </div>
          ))}
        </div>

        {/* Layer Badge */}
        <div className="mt-4 flex items-center gap-2">
          <Lock className="w-4 h-4 text-[#8B9F8D]" />
          <span className="text-xs text-[#8B9F8D]" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
            Local-first architecture ‚Ä¢ User data stays in iCloud
          </span>
        </div>
      </div>

      {/* Data Flow Arrows (Between Layers) */}
      <div className="flex justify-center my-4">
        <div className="flex flex-col items-center">
          <ArrowDown className="w-6 h-6 text-[#E85D4D] animate-bounce" />
          <span className="text-xs text-[#2D2D2D]/70 mt-1" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
            API Calls
          </span>
          <ArrowUp className="w-6 h-6 text-[#F4A460] mt-1" />
        </div>
      </div>

      {/* Layer 2: Backend Services */}
      <div
        className="mb-6 p-6 rounded-2xl border-2 transition-all duration-300"
        style={{
          backgroundColor: 'white',
          borderColor: hoveredLayer === 'backend' ? 'var(--color-heirloom-coral)' : 'var(--color-heirloom-orange)'
        }}
        onMouseEnter={() => setHoveredLayer('backend')}
        onMouseLeave={() => setHoveredLayer(null)}
      >
        {/* Layer Header */}
        <div className="flex items-center gap-3 mb-4">
          <Cloud className="w-6 h-6 text-[#E85D4D]" />
          <div>
            <h4 className="text-base font-bold text-[#2D2D2D]" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              BACKEND SERVICES
            </h4>
            <p className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              Cloud Infrastructure ‚Ä¢ Serverless Architecture
            </p>
          </div>
        </div>

        {/* Tech Blocks */}
        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
          {backendTech.map((tech) => (
            <div
              key={tech.id}
              className={`
                p-3 rounded-xl border-2 transition-all duration-300 cursor-pointer
                ${hoveredTech === tech.id ? 'scale-105 shadow-md' : 'scale-100'}
              `}
              style={{
                backgroundColor: 'var(--color-heirloom-light-cream)',
                borderColor: hoveredTech === tech.id ? tech.colorAccent : 'var(--color-heirloom-orange)'
              }}
              onMouseEnter={() => setHoveredTech(tech.id)}
              onMouseLeave={() => setHoveredTech(null)}
            >
              {/* Logo Placeholder */}
              <div
                className="w-10 h-10 rounded-lg mb-2 flex items-center justify-center text-xs font-bold"
                style={{
                  backgroundColor: tech.id === 'vercel' ? '#000000' : `${tech.colorAccent}20`,
                  color: tech.id === 'vercel' ? '#FFFFFF' : tech.colorAccent,
                  border: tech.id === 'vercel' ? '1px solid #2D2D2D' : 'none'
                }}
              >
                {tech.name.substring(0, 2).toUpperCase()}
              </div>

              {/* Tech Name */}
              <h5
                className="text-xs font-bold text-[#2D2D2D] mb-1"
                style={{ fontFamily: 'JetBrains Mono, monospace' }}
              >
                {tech.name}
              </h5>

              {/* Purpose */}
              <p
                className="text-[10px] text-[#2D2D2D]/70"
                style={{ fontFamily: 'JetBrains Mono, monospace' }}
              >
                {tech.purpose}
              </p>
            </div>
          ))}
        </div>

        {/* Layer Badges */}
        <div className="mt-4 flex flex-wrap gap-3">
          <div className="flex items-center gap-2">
            <div className="w-2 h-2 rounded-full bg-[#8B9F8D]" />
            <span className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              99.9% recipes via JSON-LD (no LLM cost)
            </span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-2 h-2 rounded-full bg-[#4299E1]" />
            <span className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              Fallback LLM for edge cases only
            </span>
          </div>
          <div className="flex items-center gap-2">
            <div className="w-2 h-2 rounded-full bg-[#F6AD55]" />
            <span className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              Zero-config sync via CloudKit
            </span>
          </div>
        </div>
      </div>

      {/* Layer 3: Data Flow */}
      <div className="p-6 rounded-2xl border-2 border-[#F4A460]/30 bg-gradient-to-r from-[#FBF8F3] to-white shadow-sm">
        {/* Layer Header */}
        <div className="flex items-center gap-3 mb-4">
          <Database className="w-6 h-6 text-[#E85D4D]" />
          <div>
            <h4 className="text-base font-bold text-[#2D2D2D]" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              DATA FLOW
            </h4>
            <p className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              Recipe Import ‚Üí Processing ‚Üí Storage ‚Üí Sync ‚Üí Share
            </p>
          </div>
        </div>

        {/* Flow Steps */}
        <div className="flex flex-wrap justify-between items-center gap-2">
          {dataFlowSteps.map((step, index) => (
            <div key={step.id} className="flex items-center">
              {/* Step Block */}
              <div className="flex flex-col items-center">
                <div className="w-12 h-12 rounded-lg bg-white border-2 border-[#E85D4D]/50 flex items-center justify-center text-2xl mb-1 shadow-sm">
                  {step.icon}
                </div>
                <div
                  className="text-[10px] text-center text-[#2D2D2D] max-w-[60px]"
                  style={{ fontFamily: 'JetBrains Mono, monospace', lineHeight: '1.2' }}
                >
                  {step.label}
                </div>
              </div>

              {/* Arrow */}
              {index < dataFlowSteps.length - 1 && (
                <div className="mx-2 text-[#E85D4D]">‚Üí</div>
              )}
            </div>
          ))}
        </div>
      </div>

      {/* Bottom Stats */}
      <div className="mt-6 pt-6 border-t-2 border-[#F4A460]/20">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
          <div>
            <div
              className="text-xl font-bold text-[#8B9F8D] mb-1"
              style={{ fontFamily: 'JetBrains Mono, monospace' }}
            >
              $0.003
            </div>
            <p className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              Cost per user/month at scale
            </p>
          </div>
          <div>
            <div
              className="text-xl font-bold text-[#E85D4D] mb-1"
              style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              99.9%
            </div>
            <p className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              Recipes parsed without LLM cost
            </p>
          </div>
          <div>
            <div
              className="text-xl font-bold text-[#E85D4D] mb-1"
              style={{ fontFamily: 'JetBrains Mono, monospace' }}
            >
              100%
            </div>
            <p className="text-xs text-[#2D2D2D]/70" style={{ fontFamily: 'JetBrains Mono, monospace' }}>
              User data privacy (local + iCloud)
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
