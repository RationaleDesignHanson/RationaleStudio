Firestore Security Rules for Rationale Studio
==============================================

Add these rules to Firebase Console > Firestore Database > Rules

Instructions:
1. Go to: https://console.firebase.google.com/project/rationaledesigns-4d354/firestore/rules
2. Replace the existing rules with the rules below
3. Click "Publish"

==============================================

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // User profiles (existing rule)
    match /users/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
    }

    // Outbound pitches - Owner only
    match /outbound_pitches/{pitchId} {
      allow read, write: if request.auth != null &&
                            request.auth.token.role == 'owner';
    }

    // Pitch analytics - Owner read, system write (unauthenticated tracking)
    match /pitch_analytics/{analyticsId} {
      allow read: if request.auth != null &&
                     request.auth.token.role == 'owner';
      allow create: if true;  // Allow unauthenticated tracking
      allow update, delete: if request.auth != null &&
                              request.auth.token.role == 'owner';
    }

    // Integration links - Owner write, authenticated users read
    match /integration_links/{linkId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &&
                      request.auth.token.role == 'owner';
    }

    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

==============================================

Security Model Explanation:

1. User Profiles:
   - Users can only read/write their own profile
   - Prevents unauthorized access to other user data

2. Outbound Pitches:
   - Only owner role can read/write
   - Keeps pitch data confidential to business owner

3. Pitch Analytics:
   - Owner can read all analytics
   - Anyone can create analytics (unauthenticated tracking)
   - Only owner can update/delete analytics

4. Integration Links:
   - All authenticated users can read links
   - Only owner can create/update/delete links
   - Centralized link management

5. Default Deny:
   - All other collections are blocked by default
   - Explicit security by design

==============================================
